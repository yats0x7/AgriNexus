import React, { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Mic, MicOff } from 'lucide-react';
import { Badge } from '@/components/ui/badge';

export default function VoiceSearch({ onVoiceResult, placeholder = "Say something..." }) {
    const [isListening, setIsListening] = useState(false);
    const [transcript, setTranscript] = useState('');

    const startListening = () => {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'hi-IN'; // Hindi (India)
            
            recognition.onstart = () => {
                setIsListening(true);
                setTranscript('');
            };
            
            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                setTranscript(result);
                onVoiceResult(result);
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                setIsListening(false);
            };
            
            recognition.onend = () => {
                setIsListening(false);
            };
            
            recognition.start();
        } else {
            alert('Speech recognition not supported in this browser');
        }
    };

    return (
        <div className="flex flex-col gap-2">
            <Button
                variant={isListening ? "destructive" : "outline"}
                size="sm"
                onClick={startListening}
                disabled={isListening}
                className="flex items-center gap-2"
            >
                {isListening ? <MicOff className="w-4 h-4" /> : <Mic className="w-4 h-4" />}
                {isListening ? 'Listening...' : 'Voice Search'}
            </Button>
            {transcript && (
                <Badge variant="secondary" className="text-xs">
                    Heard: "{transcript}"
                </Badge>
            )}
        </div>
    );
}